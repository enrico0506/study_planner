<!DOCTYPE html>
<html lang="en" data-theme="breeze">
<head>
  <meta charset="UTF-8" />
  <title>Study Planner – Karteikarten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#2f62f4" />
  <script>
    (function() {
      try {
        const savedTheme = localStorage.getItem("studyTheme_v1");
        if (savedTheme) {
          document.documentElement.setAttribute("data-theme", savedTheme);
        }
      } catch (e) {}
    })();
  </script>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./public/icons/app-icon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./src/styles/main.css" />
  <link rel="stylesheet" href="./src/styles/mobile.css" />
  <link rel="stylesheet" href="./src/styles/phone-pages.css" />
  <link rel="stylesheet" href="./src/styles/phone-menu.css" />
  <link rel="stylesheet" href="./src/styles/phone-modals.css" />
  <link rel="stylesheet" href="./src/styles/a11y.css" />
  <link rel="stylesheet" href="./src/styles/enhancements.css" />
  <link rel="stylesheet" href="./src/styles/karteikarten.css" />
  <script src="./src/review-engine.js" defer></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body class="flashcards-page">
  <div class="flashcards-shell">
    <div class="header-row flashcards-header">
      <div class="header-main">
        <p class="eyebrow">Retention</p>
        <h1>Karteikarten</h1>
        <p class="subtitle">
          Stapel anlegen, Karten importieren oder schnell tippen. Wechsle zwischen Normal (kenne ich / wiederholen)
          oder Intervall (Anki-ähnliche Abstände anhand deines Feedbacks).
        </p>
      </div>
      <div class="header-actions">
        <a class="btn btn-secondary header-calendar-btn" href="index.html">← Back to board</a>
        <a class="btn btn-secondary header-calendar-btn" href="calendar.html">Calendar</a>
        <a class="btn btn-secondary header-calendar-btn" href="account.html">Account</a>
        <div class="header-menu" aria-label="Menu">
          <button class="header-menu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Open menu">...</button>
          <div class="header-menu-panel">
            <div class="header-menu-group">
              <div class="header-menu-subtitle">Pages</div>
              <a class="header-menu-link" href="./index.html?mode=board">Board</a>
              <a class="header-menu-link" href="./index.html?mode=subjects">Subjects</a>
              <a class="header-menu-link" href="./index.html?mode=today">Today's focus</a>
              <a class="header-menu-link" href="./index.html?mode=schedule">Daily schedule</a>
            </div>
            <div class="header-menu-divider"></div>
	            <div class="header-menu-group">
	              <div class="header-menu-subtitle">Study hubs</div>
	              <a class="header-menu-link" href="./calendar.html">Calendar</a>
	              <a class="header-menu-link" href="./stundenplan.html">Stundenplan</a>
	              <a class="header-menu-link" href="./karteikarten.html">Karteikarten</a>
	              <a class="header-menu-link" href="./account.html">Account</a>
	            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="flashcards-layout">
      <aside class="deck-column">
        <div class="deck-card deck-card-decks">
          <div class="deck-card-head">
            <div>
              <div class="deck-card-label">Stapel</div>
              <div class="deck-card-title">Wähle oder lege an</div>
            </div>
            <button class="chip-btn chip-btn-primary" id="focusDeckNameBtn" type="button">+ Neuer Stapel</button>
          </div>
          <div class="deck-list-scroll">
            <div class="deck-list" id="deckList"></div>
          </div>
          <form class="deck-form" id="deckForm">
            <label>
              Name des Stapels
              <input type="text" id="deckNameInput" placeholder="z. B. Anatomie, Vokabeln" required />
            </label>
            <label>
              Notiz (optional)
              <input type="text" id="deckDescriptionInput" placeholder="Kurzbeschreibung für dich" />
            </label>
            <div class="deck-form-actions">
              <button class="btn btn-secondary" type="reset">Reset</button>
              <button class="btn" type="submit">Stapel speichern</button>
            </div>
          </form>
        </div>

        <div class="deck-card deck-card-import">
          <details class="import-collapsible" open>
            <summary>
              <div class="import-collapsible-summary">
                <div>
                  <div class="deck-card-title">Import / Export</div>
                  <p class="deck-card-subtitle">CSV: Vorderseite, Rückseite, optional Hinweis.</p>
                </div>
                <span class="import-caret" aria-hidden="true">⌄</span>
              </div>
            </summary>
            <div class="import-actions">
              <button class="btn" id="openCsvModalBtn" type="button">CSV importieren…</button>
              <button class="btn btn-secondary" id="exportDeckBtn" type="button">Deck exportieren (CSV)</button>
            </div>
            <div class="import-status" id="importStatus"></div>
          </details>
        </div>
      </aside>

      <section class="flashcards-main">
        <div class="flashcards-top">
          <div>
            <div class="flashcards-label">Aktiver Stapel</div>
            <div class="flashcards-title" id="activeDeckTitle">Kein Stapel</div>
            <div class="flashcards-meta" id="activeDeckMeta">0 Karten • 0 fällig</div>
          </div>
          <div class="mode-toggle" role="tablist" aria-label="Review-Modus">
            <button class="mode-btn mode-btn-active" data-mode="normal" id="modeNormalBtn" type="button">Normal</button>
            <button class="mode-btn" data-mode="interval" id="modeIntervalBtn" type="button">Intervall (Anki)</button>
          </div>
        </div>

        <div class="card-editor">
          <div class="card-editor-form">
            <div class="card-editor-head">
              <div>
                <div class="deck-card-label">Neue Karte</div>
                <div class="deck-card-title">Schnell hinzufügen</div>
              </div>
              <div class="card-editor-actions">
                <button class="chip-btn" id="prefillActiveFrontBtn" type="button">Aktiven Titel übernehmen</button>
                <button class="btn" id="openCardModalBtn" type="button">Karte anlegen</button>
              </div>
            </div>
            <form class="quick-add" id="quickAddForm">
              <div class="quick-add-grid">
                <label>
                  Vorderseite
                  <textarea id="quickFrontInput" rows="2" placeholder="Frage / Begriff" required></textarea>
                </label>
                <label>
                  Rückseite
                  <textarea id="quickBackInput" rows="3" placeholder="Antwort / Erklärung" required></textarea>
                </label>
                <label>
                  Hinweis (optional)
                  <input id="quickHintInput" type="text" placeholder="z. B. Kontext, Merksatz" />
                </label>
              </div>
              <div class="quick-add-actions">
                <div class="quick-add-status" id="quickAddStatus" role="status" aria-live="polite"></div>
                <button class="btn" type="submit">Hinzufügen</button>
              </div>
            </form>
          </div>

          <div class="card-editor-list">
            <div class="card-editor-list-head">
              <div>
                <div class="deck-card-label">Karten im Stapel</div>
                <div class="deck-card-title">Übersicht</div>
              </div>
              <div class="flashcards-meta" id="deckStats"></div>
            </div>
            <div class="card-browser-tools">
              <input class="card-search" id="cardSearchInput" type="search" placeholder="Suchen (Vorder-/Rückseite/Hinweis)..." />
              <button class="btn btn-secondary" id="bulkDeleteBtn" type="button" disabled>Löschen</button>
            </div>
            <div class="card-list" id="cardList"></div>
          </div>
        </div>

        <div class="review-panel">
          <div class="review-head">
            <div>
              <div class="deck-card-label">Abfrage</div>
              <div class="deck-card-title" id="reviewModeLabel">Normaler Durchgang</div>
              <div class="flashcards-meta" id="reviewStats">Bereit, sobald Karten vorhanden sind.</div>
            </div>
            <div class="review-actions-compact">
              <button class="chip-btn chip-btn-primary" id="startReviewBtn" type="button">Start review</button>
              <button class="chip-btn" id="rebuildQueueBtn" type="button">Neu mischen</button>
              <button class="chip-btn" id="showUpcomingBtn" type="button">Fällige Karten</button>
            </div>
          </div>
          <div class="review-start-row">
            <div class="review-progress" id="reviewProgress"></div>
          </div>
          <div class="review-card" id="reviewCard">
            <div class="review-card-body">
              <div class="review-face" id="reviewFront">Keine Karte geladen</div>
              <div class="review-face review-back" id="reviewBack"></div>
            </div>
            <div class="review-foot">
              <button class="btn btn-secondary" id="showAnswerBtn" type="button">Antwort anzeigen</button>
              <div class="review-actions" id="normalActions">
                <button class="chip-btn chip-btn-primary" id="markKnownBtn" type="button">Kenne ich</button>
                <button class="chip-btn" id="markRepeatBtn" type="button">Nochmal</button>
              </div>
              <div class="review-actions interval-actions" id="intervalActions">
                <button class="chip-btn" data-rating="again" type="button">Wiederholen</button>
                <button class="chip-btn" data-rating="hard" type="button">Schwer</button>
                <button class="chip-btn chip-btn-primary" data-rating="good" type="button">Gut</button>
                <button class="chip-btn" data-rating="easy" type="button">Leicht</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Karte anlegen Modal -->
  <div class="calendar-modal" id="cardModal" aria-hidden="true">
    <div class="calendar-modal-backdrop" id="cardModalBackdrop"></div>
    <div class="calendar-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="cardModalTitle">
      <div class="calendar-modal-head">
        <div>
          <div class="modal-label">Karteikarten</div>
          <div class="modal-title" id="cardModalTitle">Neue Karte</div>
          <div class="modal-subtitle">Lege Vorder- und Rückseite an, optional mit LaTeX.</div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="closeCardModalBtn" type="button">Schließen</button>
        </div>
      </div>
      <form id="cardForm" class="calendar-form">
        <div class="form-row">
          <label>
            Stapel
            <select id="cardDeckSelect"></select>
          </label>
        </div>
        <div class="form-row">
          <label>
            Vorderseite
            <textarea id="cardFrontInput" rows="3" placeholder="Frage, Prompt oder Begriff" required></textarea>
          </label>
        </div>
        <div class="form-row">
          <label>
            Rückseite
            <textarea id="cardBackInput" rows="4" placeholder="Antwort, Definition, Beispiel" required></textarea>
          </label>
        </div>
        <div class="form-row">
          <label>
            Hinweis (optional)
            <input id="cardHintInput" type="text" placeholder="Kontext, Merksatz, Quelle" />
          </label>
        </div>
        <div class="calendar-form-actions">
          <div class="calendar-form-status" id="cardFormStatus"></div>
          <div class="calendar-form-buttons">
            <button class="btn btn-secondary" type="reset">Reset</button>
            <button class="btn" type="submit">Karte speichern</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- CSV Import Modal -->
  <div class="calendar-modal" id="csvModal" aria-hidden="true">
    <div class="calendar-modal-backdrop" id="csvModalBackdrop"></div>
    <div class="calendar-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="csvModalTitle">
      <div class="calendar-modal-head">
        <div>
          <div class="modal-label">Karteikarten</div>
          <div class="modal-title" id="csvModalTitle">CSV importieren</div>
          <div class="modal-subtitle">Wähle Datei, Ziel-Stapel und Trennzeichen.</div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="closeCsvModalBtn" type="button">Schließen</button>
        </div>
      </div>
      <form class="calendar-form" id="csvForm">
        <div class="form-row">
          <label>
            Datei
            <input type="file" id="csvFileInput" accept=".csv,text/csv" />
          </label>
        </div>
        <div class="form-row">
          <label>
            Ziel-Stapel
            <select id="csvDeckSelect"></select>
          </label>
        </div>
        <div class="form-row">
          <label>
            Trennzeichen
            <select id="csvDelimiterSelect">
              <option value="auto">Automatisch erkennen</option>
              <option value=",">Komma</option>
              <option value=";">Semikolon</option>
              <option value="|">Pipe</option>
              <option value="tab">Tab</option>
            </select>
          </label>
        </div>
        <div class="form-row">
          <div class="csv-preview" id="csvPreview" hidden></div>
          <div class="csv-error" id="csvError" hidden></div>
        </div>
        <div class="calendar-form-actions">
          <div class="calendar-form-status" id="csvStatus"></div>
          <div class="calendar-form-buttons">
            <button class="btn btn-secondary" id="clearCsvBtn" type="button">Reset</button>
            <button class="btn" id="importCsvBtn" type="button">CSV importieren</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <script src="./src/storage.js" defer></script>
  <script src="./src/pwa.js" defer></script>
  <script src="./src/sync.js" defer></script>
  <script src="./src/page-menu.js" defer></script>
  <script src="./src/karteikarten.js" defer></script>
</body>
</html>
