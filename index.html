<!DOCTYPE html>
<html lang="en" data-theme="breeze">
<head>
  <meta charset="UTF-8" />
  <title>Study Planner ‚Äì Confidence Table</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#2f62f4" />
  <script>
    (function() {
      try {
        const savedTheme = localStorage.getItem("studyTheme_v1");
        if (savedTheme) {
          document.documentElement.setAttribute("data-theme", savedTheme);
        }
      } catch (e) {}
    })();
  </script>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./public/icons/app-icon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./src/styles/main.css" />
  <link rel="stylesheet" href="./src/styles/mobile.css" />
  <link rel="stylesheet" href="./src/styles/phone.css" />
  <link rel="stylesheet" href="./src/styles/phone-menu.css" />
  <link rel="stylesheet" href="./src/styles/phone-modals.css" />
  <link rel="stylesheet" href="./src/styles/a11y.css" />
  <link rel="stylesheet" href="./src/styles/enhancements.css" />
  <link rel="stylesheet" href="./src/styles/notes.css" />
  <link rel="stylesheet" href="./src/styles/insights.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body>
  <div class="app" id="appRoot">
    <div class="header-row">
      <div class="header-main">
        <h1>Study Planner</h1>
        <p class="subtitle">
          Columns = subjects ¬∑ Rows = files with confidence ¬∑ Drag files to reorder ¬∑ Track time per file.
        </p>
      </div>
      <div class="header-actions">
        <div class="view-toggle" role="tablist" aria-label="Choose view">
          <button class="view-toggle-btn view-toggle-active" id="viewBoardBtn" type="button" aria-selected="true">
            Board
          </button>
          <button class="view-toggle-btn" id="viewScheduleBtn" type="button" aria-selected="false">
            Daily schedule
          </button>
        </div>
        <div class="header-quick-dropdown" id="quickJumpDropdown">
          <button class="header-quick-trigger" id="quickJumpTrigger" type="button" aria-haspopup="true" aria-expanded="false">
            <span class="header-quick-label">Study hubs</span>
            <span class="header-quick-caret" aria-hidden="true">‚åÑ</span>
          </button>
	          <div class="header-quick-panel" id="quickJumpPanel">
	            <a class="header-quick-item" href="./calendar.html">Calendar</a>
	            <a class="header-quick-item" href="./stundenplan.html">Stundenplan</a>
	            <a class="header-quick-item" href="./karteikarten.html">Karteikarten</a>
	          </div>
	        </div>
        <div class="confidence-toggle" role="group" aria-label="Confidence mode">
          <button class="confidence-toggle-btn confidence-toggle-active" id="manualConfBtn" type="button" data-mode="manual">
            Your confidence
          </button>
          <button class="confidence-toggle-btn" id="perceivedConfBtn" type="button" data-mode="perceived">
            Calculated
          </button>
        </div>
        <div class="header-menu" id="headerMenu" aria-label="Menu">
          <button class="header-menu-toggle" id="headerMenuToggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Open menu">
            ...
          </button>
          <div class="header-menu-panel" id="headerMenuPanel">
            <div class="header-menu-group mobile-menu-only">
              <a class="header-menu-link" href="./index.html?mode=board">Board</a>
              <a class="header-menu-link" href="./index.html?mode=subjects">Subjects</a>
              <a class="header-menu-link" href="./index.html?mode=today">Today's focus</a>
              <a class="header-menu-link" href="./index.html?mode=schedule">Daily schedule</a>
            </div>
            <div class="header-menu-divider mobile-menu-only"></div>
	            <div class="header-menu-group mobile-menu-only">
	              <div class="header-menu-subtitle">Study hubs</div>
	              <a class="header-menu-link" href="./calendar.html">Calendar</a>
	              <a class="header-menu-link" href="./stundenplan.html">Stundenplan</a>
	              <a class="header-menu-link" href="./karteikarten.html">Karteikarten</a>
	            </div>
            <div class="header-menu-divider mobile-menu-only"></div>
            <div class="header-menu-group">
              <button class="header-menu-item" id="headerProfileBtn" type="button">Login</button>
              <button class="header-menu-item" id="headerSettingsBtn" type="button">Settings</button>
            </div>
	            <div class="header-menu-divider"></div>
	            <div class="header-menu-group">
	              <button class="header-menu-link" id="openSuggestionsBtn" type="button">Suggestions</button>
	              <button class="header-menu-link" id="openStatsBtn" type="button">Study stats</button>
	            </div>
	          </div>
	        </div>
	      </div>
	    </div>

    <div class="settings-modal" id="settingsModal" aria-hidden="true">
      <div class="settings-backdrop" id="settingsModalBackdrop"></div>
      <div class="settings-dialog" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
        <div class="settings-head">
          <div>
            <div class="settings-label">Settings</div>
            <div class="settings-title" id="settingsModalTitle">Customize your space</div>
            <div class="settings-subtitle">Theme, colors, and preferences in one place.</div>
          </div>
          <button class="btn btn-secondary" id="settingsModalCloseBtn" type="button">Close</button>
        </div>
        <div class="settings-body">
          <div class="settings-nav" id="settingsNav">
            <button class="settings-nav-item settings-nav-active" data-panel="settingsThemePanel" type="button">Theme</button>
            <button class="settings-nav-item" data-panel="settingsColorsPanel" type="button">Colors</button>
            <button class="settings-nav-item" data-panel="settingsPrefsPanel" type="button">Preferences</button>
            <button class="settings-nav-item" data-panel="settingsDataPanel" type="button">Data</button>
          </div>
          <div class="settings-panels">
            <div class="settings-panel settings-panel-active" id="settingsThemePanel">
              <div class="settings-panel-title">Theme</div>
              <p class="settings-panel-text">Switch between available themes. Use the list below to apply instantly.</p>
              <div class="settings-theme-list" id="settingsThemeList"></div>
              <button class="btn" id="settingsThemePickerBtn" type="button">Open theme picker</button>
            </div>
            <div class="settings-panel" id="settingsColorsPanel">
              <div class="settings-panel-title">Colors</div>
              <p class="settings-panel-text">Adjust the palette used for subjects and the style of confidence/study bars.</p>
              <div class="settings-colors-list" id="settingsColorsList"></div>
              <div class="settings-pref-grid">
                <label>
                  Confidence bar style
                  <select id="settingsMeterStyleSelect">
                    <option value="classic">Classic gradient</option>
                    <option value="flat">Flat colors</option>
                    <option value="stripe">Striped</option>
                    <option value="single">Single color</option>
                    <option value="customGradient">Custom gradient</option>
                  </select>
                </label>
                <label>
                  Meter color (single)
                  <input type="color" id="settingsMeterSingleInput" value="#f97373" />
                </label>
                <label>
                  Gradient start
                  <input type="color" id="settingsMeterGradStartInput" value="#f97373" />
                </label>
                <label>
                  Gradient end
                  <input type="color" id="settingsMeterGradEndInput" value="#22c55e" />
                </label>
                <label>
                  Study bar style
                  <select id="settingsStudyBarStyleSelect">
                    <option value="rounded">Rounded</option>
                    <option value="flat">Flat</option>
                    <option value="stripe">Striped</option>
                  </select>
                </label>
              </div>
              <div class="settings-preview" id="settingsPreview">
                <div class="settings-preview-title">Preview</div>
                <div class="settings-preview-meter">
                  <div class="settings-preview-label">Overall confidence</div>
                  <div class="summary-progress-bar">
                    <div class="summary-progress-fill meter-mid" id="settingsPreviewMeterFill" style="width:65%"></div>
                  </div>
                </div>
                <div class="settings-preview-study">
                  <div class="settings-preview-label">Today's study</div>
                  <div class="summary-study-bar" id="settingsPreviewStudyBar"></div>
                </div>
              </div>
              <div class="settings-colors-actions">
                <button class="btn btn-secondary" id="settingsColorsResetBtn" type="button">Reset palette</button>
                <button class="btn" id="settingsColorsSaveBtn" type="button">Save colors & styles</button>
              </div>
            </div>
            <div class="settings-panel" id="settingsPrefsPanel">
              <div class="settings-panel-title">Preferences</div>
              <p class="settings-panel-text">Choose language, accessibility, and tweak study timers.</p>
              <div class="settings-pref-row">
                <label>
                  Language
                  <select id="settingsLanguageSelect">
                    <option value="en">English</option>
                    <option value="de">Deutsch</option>
                  </select>
                </label>
              </div>
              <div class="settings-pref-row settings-pref-grid">
                <label>
                  Contrast
                  <select id="settingsContrastSelect">
                    <option value="normal">Normal</option>
                    <option value="high">High contrast</option>
                    <option value="low">Low contrast</option>
                  </select>
                </label>
                <label>
                  Colorblind-friendly colors
                  <select id="settingsCvdSelect">
                    <option value="none">Off</option>
                    <option value="safe">On</option>
                  </select>
                </label>
              </div>
              <div class="settings-pref-row settings-pref-grid">
                <label>
                  Study length (minutes)
                  <input type="number" id="settingsStudyMinutes" min="1" />
                </label>
                <label>
                  Short break (minutes)
                  <input type="number" id="settingsShortMinutes" min="1" />
                </label>
                <label>
                  Long break (minutes)
                  <input type="number" id="settingsLongMinutes" min="1" />
                </label>
              </div>
              <div class="settings-panel-title" style="font-size:14px; margin-top:12px;">Time budget</div>
              <p class="settings-panel-text">Optional guardrails: warn or stop when exceeding your limits.</p>
              <div class="settings-pref-row settings-pref-grid">
                <label>
                  Daily max (minutes, 0 = off)
                  <input type="number" id="budgetDailyMax" min="0" step="15" value="0" />
                </label>
                <label>
                  Weekly max (minutes, 0 = off)
                  <input type="number" id="budgetWeeklyMax" min="0" step="30" value="0" />
                </label>
                <label>
                  Mode
                  <select id="budgetMode">
                    <option value="warn">Warn only</option>
                    <option value="hard">Hard stop (no new sessions)</option>
                  </select>
                </label>
              </div>
              <div class="settings-panel-title" style="font-size:14px; margin-top:12px;">Notifications</div>
              <p class="settings-panel-text">In-app toasts always work; system notifications require permission (https/localhost).</p>
              <div class="settings-pref-row settings-pref-grid">
                <label>
                  <input id="notifEnableToasts" type="checkbox" checked />
                  Enable in-app toasts
                </label>
                <label>
                  <input id="notifEnableSystem" type="checkbox" />
                  Enable system notifications
                </label>
                <label>
                  Reminder lead time
                  <select id="notifLeadTime">
                    <option value="10">10 min</option>
                    <option value="30">30 min</option>
                    <option value="60">60 min</option>
                  </select>
                </label>
                <label>
                  Quiet hours
                  <input id="notifQuietStart" type="time" value="22:00" /> to
                  <input id="notifQuietEnd" type="time" value="07:00" />
                </label>
              </div>
              <div class="settings-colors-actions">
                <button class="btn" id="settingsPrefsSaveBtn" type="button">Save preferences</button>
              </div>
            </div>
            <div class="settings-panel" id="settingsDataPanel">
              <div class="settings-panel-title">Data safety</div>
              <p class="settings-panel-text">
                Export a full local backup (JSON). Import validates first and creates an automatic snapshot so you can undo. Snapshots are stored locally on this device.
              </p>
              <div class="settings-pref-grid">
                <label>
                  Export
                  <button class="btn" id="settingsExportBtn" type="button">Export my data</button>
                </label>
                <label>
                  Import file
                  <input id="settingsImportFile" type="file" accept="application/json" />
                </label>
                <label>
                  Import mode
                  <select id="settingsImportMode">
                    <option value="merge">Merge (recommended)</option>
                    <option value="replace">Replace (delete missing keys)</option>
                  </select>
                </label>
                <label>
                  Import
                  <button class="btn btn-secondary" id="settingsImportBtn" type="button">Import data‚Ä¶</button>
                </label>
              </div>
              <div class="settings-data-actions">
                <button class="btn btn-secondary" id="settingsSnapshotNowBtn" type="button">Create snapshot now</button>
              </div>
              <div class="settings-data-status" id="settingsDataStatus" role="status" aria-live="polite"></div>
              <div class="settings-data-snapshots">
                <div class="settings-panel-title" style="font-size:14px; margin-top:10px;">Local snapshots (last 12)</div>
                <div id="settingsSnapshotList"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top row: Summary + Focus -->
    <div class="top-row">
      <!-- Summary -->
      <div class="summary-card">
        <div class="summary-top">
          <div class="summary-metrics">
            <div class="summary-block">
              <div class="summary-label">Subjects</div>
              <div class="summary-value" id="summarySubjects">0</div>
            </div>
            <div class="summary-block">
              <div class="summary-label">Files</div>
              <div class="summary-value" id="summaryFiles">0</div>
            </div>
            <div class="summary-block">
              <div class="summary-label">Low confidence (&lt; 40%)</div>
              <div class="summary-value" id="summaryLow">0</div>
            </div>
          </div>
        </div>
      <div class="summary-progress">
        <div class="summary-progress-header">
          <span>Overall confidence</span>
          <span id="summaryConfLabel">0%</span>
        </div>
        <div class="summary-progress-bar">
          <div class="summary-progress-fill meter-low" id="summaryConfFill"></div>
        </div>
      </div>
      <div class="summary-goal">
        <div class="summary-goal-header">
          <div>
            <div class="summary-label">Weekly target</div>
            <div class="summary-goal-line">
              <span class="summary-goal-amount" id="weeklyGoalProgressLabel">0 h</span>
              <span class="summary-goal-divider">/</span>
              <span class="summary-goal-total" id="weeklyGoalTotalLabel">0 h</span>
            </div>
          </div>
          <button class="chip-btn chip-btn-primary" id="editGoalBtn" type="button">Set goal</button>
        </div>
        <div class="summary-goal-track">
          <div class="summary-goal-fill" id="weeklyGoalFill"></div>
        </div>
        <div class="summary-goal-footer">
          <div class="summary-goal-hint" id="weeklyGoalHint">Set a target to get a weekly rhythm.</div>
          <div class="summary-streak">
            <div class="summary-streak-icon">üî•</div>
            <div class="summary-streak-text">
              <div class="summary-streak-label">Daily streak</div>
              <div class="summary-streak-value">
                <span id="streakCurrentLabel">0 days</span>
                <span class="summary-streak-sep">¬∑</span>
                <span id="streakBestLabel">Best 0</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="summary-study">
        <div class="summary-study-header">
          <span>Today's study time</span>
          <span id="summaryStudyTodayLabel">0 min</span>
        </div>
          <div class="summary-study-bar" id="summaryStudyBar"></div>
          <div class="summary-study-legend" id="summaryStudyLegend"></div>
        </div>
      </div>

      <!-- Focus timer -->
      <div class="focus-card" id="focusCard">
        <div class="focus-main">
          <div class="focus-left">
            <div class="focus-label">Focus session</div>
            <div class="focus-title" id="focusSessionTitle">No active session</div>
            <div class="focus-subtitle" id="focusSessionSubtitle">
              Click ‚ÄúStudy‚Äù on a file or start a break below.
            </div>
            <div class="focus-session-controls" id="focusSessionControls">
              <span style="font-size:0.75rem;color:#9ca3af;">No controls ‚Äì start a session.</span>
            </div>
          </div>
          <div class="focus-right">
            <div class="focus-timer-toggle" role="group" aria-label="Timer mode">
              <button class="focus-timer-mode-btn focus-timer-active" id="timerModeCountdownBtn" type="button" data-mode="countdown">Countdown</button>
              <button class="focus-timer-mode-btn" id="timerModeStopwatchBtn" type="button" data-mode="stopwatch">Stopwatch</button>
            </div>
            <div class="focus-timer-box">
              <div class="focus-timer-label-small" id="focusTimerLabel">Countdown</div>
              <div class="focus-timer-display" id="focusTimerDisplay">00:00:00</div>
            </div>
          </div>
        </div>
        <div class="focus-bottom">
          <button class="focus-break-btn" id="openTimerSettingsBtn" type="button">
            Timer settings
          </button>
          <div class="focus-break-buttons">
            <button class="focus-break-btn" id="startShortBreakBtn" type="button">Short break</button>
            <button class="focus-break-btn" id="startLongBreakBtn" type="button">Long break</button>
          </div>
        </div>
      <div class="focus-inline-settings" id="timerInlinePanel" hidden>
        <div class="focus-inline-title">Adjust your timers</div>
        <div class="focus-inline-grid">
          <label>
            Study (minutes)
            <input type="number" id="timerInlineStudy" min="1" />
          </label>
          <label>
            Short break
            <input type="number" id="timerInlineShort" min="1" />
          </label>
          <label>
            Long break
            <input type="number" id="timerInlineLong" min="1" />
          </label>
        </div>
        <div class="focus-inline-actions">
          <button class="btn btn-secondary" id="timerInlineCancel" type="button">Cancel</button>
          <button class="btn" id="timerInlineSave" type="button">Save</button>
        </div>
      </div>
    </div>
    </div>

    <!-- Controls placeholder -->
    <div class="controls"></div>

    <div class="layout-row" id="layoutRow">
      <div class="main-area">
        <!-- Table -->
        <div class="table-wrapper">
          <div class="subject-scroll">
            <div class="section-heading">
              <div class="section-heading-text">
                <h2 class="section-title">Subjects</h2>
                <p class="section-subtitle">Manage all your subjects and files here.</p>
              </div>
              <div class="section-actions">
                <button class="subject-nav-btn mobile-menu-only" id="subjectBackBtn" type="button" aria-label="Back">‚Üê</button>
                <button class="subject-nav-btn mobile-menu-only" id="subjectPrevBtn" type="button" aria-label="Previous subject">‚Äπ</button>
                <div class="subject-nav-label mobile-menu-only" id="subjectNavLabel" aria-hidden="true"></div>
                <button class="subject-nav-btn mobile-menu-only" id="subjectNextBtn" type="button" aria-label="Next subject">‚Ä∫</button>
                <button class="subject-scroll-head-btn" id="subjectScrollLeftBtn" type="button" aria-label="Scroll subjects left">‚Äπ</button>
                <button class="subject-scroll-head-btn" id="subjectScrollRightBtn" type="button" aria-label="Scroll subjects right">‚Ä∫</button>
                <button class="section-max-btn" id="maximizeSubjectsBtn" type="button" aria-pressed="false" aria-label="Maximize subjects">‚§¢</button>
              </div>
            </div>
            <div id="subjectTable" class="subject-table"></div>
          </div>
        </div>
        <div class="empty-hint" id="emptyHint">
          No subjects yet. Use ‚ÄúAdd subject‚Äù on the right to create your first subject.
        </div>
      </div>

      <aside class="today-sidebar">
        <div class="today-section">
          <div class="today-header">
            <div class="today-header-text">
              <h2>Today's focus</h2>
            </div>
            <div class="today-header-actions"></div>
          </div>
          <div class="today-dropzone" id="todayDropZone">
            Drag a file card here to add it to today's todo list.
          </div>
          <div class="today-list" id="todayList"></div>
        </div>
      </aside>
    </div>

    <div class="schedule-view" id="scheduleView" hidden>
      <div class="schedule-bar">
        <div>
          <div class="schedule-title">Daily focus timeline</div>
          <div class="schedule-subtitle">
            Each column is a day. Today mirrors "Today's focus"; past days keep their history.
          </div>
        </div>
        <div class="schedule-actions">
          <button class="chip-btn chip-btn-primary" id="scheduleTodayBtn" type="button">This week</button>
          <div class="schedule-nav">
            <button class="schedule-nav-btn" id="schedulePrevWeekBtn" type="button" aria-label="Previous week">‚Äπ</button>
            <div class="schedule-range" id="scheduleRangeLabel">This week</div>
            <button class="schedule-nav-btn" id="scheduleNextWeekBtn" type="button" aria-label="Next week">‚Ä∫</button>
          </div>
        </div>
      </div>
      <div class="schedule-grid" id="scheduleGrid"></div>
    </div>

    <!-- Add-to-Today Modal -->
    <div class="modal-backdrop" id="addTodoModalBackdrop" hidden>
      <div class="modal" role="dialog" aria-modal="true">
        <div class="modal-header">
          <div>
            <div class="modal-title" id="addTodoModalTitle">Add to Today</div>
            <div class="modal-subtitle" id="addTodoModalSubtitle">
              Add optional subtasks before sending this item to Today.
            </div>
          </div>
          <button class="modal-close-btn" id="addTodoModalClose" aria-label="Close">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="modal-field">
            <div class="modal-field-label">Subtasks (optional)</div>
            <div class="subtask-input-row">
              <input type="text" id="addTodoSubtaskInput" placeholder="Type a subtask and press Enter" />
              <button class="chip-btn chip-btn-primary" id="addTodoSubtaskAdd" type="button">+</button>
            </div>
            <div class="subtask-list" id="addTodoSubtaskList"></div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="spacer"></div>
          <button class="btn btn-secondary" id="addTodoModalCancel" type="button">Cancel</button>
          <button class="btn" id="addTodoModalSave" type="button">Add to Today</button>
        </div>
      </div>
    </div>

    <!-- Schedule Task Modal -->
    <div class="modal-backdrop" id="scheduleTaskModalBackdrop" hidden>
      <div class="modal" role="dialog" aria-modal="true">
        <div class="modal-header">
          <div>
            <div class="modal-title" id="scheduleTaskModalTitle">Task</div>
            <div class="modal-subtitle" id="scheduleTaskModalSubtitle">Subtasks for this focus item.</div>
          </div>
          <button class="modal-close-btn" id="scheduleTaskCloseBtn" aria-label="Close">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="schedule-task-subtasks" id="scheduleTaskModalSubtasks"></div>
        </div>
        <div class="modal-footer">
          <div class="spacer"></div>
          <button class="btn" id="scheduleTaskStudyBtn" type="button">Study</button>
        </div>
      </div>
    </div>
  </div>

  <!-- File Modal -->
  <div class="modal-backdrop" id="fileModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="fileModalTitle">Add file</div>
          <div class="modal-subtitle" id="fileModalSubtitle">Fill the details below and save.</div>
        </div>
        <button class="modal-close-btn" id="fileModalCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="modal-field-row">
          <label for="modalFileName">File / Topic</label>
          <input type="text" id="modalFileName" placeholder="e.g. Kapitel 3 Zusammenfassung.pdf" />
        </div>
        <div class="modal-field-row modal-row-inline">
          <div>
            <label for="modalSubjectSelect">Subject</label>
            <select id="modalSubjectSelect">
              <option value="">No subjects yet</option>
            </select>
          </div>
          <div>
            <label>Confidence</label>
            <div class="range-row">
              <input type="range" id="modalConfidenceRange" min="0" max="100" step="5" value="50" />
              <div class="range-value" id="modalConfidenceValue">50%</div>
            </div>
          </div>
        </div>
        <div class="modal-field-row">
          <label for="modalFileNotes">Notes (optional)</label>
          <input type="text" id="modalFileNotes" placeholder="e.g. 'Important formulas on page 3'" />
        </div>
        <div class="modal-field-row">
          <button class="btn btn-secondary" id="openFileNotesBtn" type="button">Open notes (Markdown)</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-delete-btn" id="fileModalDeleteBtn" hidden>Delete file</button>
        <div class="spacer"></div>
        <button class="btn btn-secondary" id="fileModalCancelBtn" type="button">Cancel</button>
        <button class="btn" id="fileModalSaveBtn" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- Timer Settings Modal -->
  <div class="modal-backdrop" id="timerModalBackdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div>
          <div class="modal-title">Timer settings</div>
          <div class="modal-subtitle">
            Set durations for study sessions and breaks (Pomodoro style).
          </div>
        </div>
        <button class="modal-close-btn" id="timerModalCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="modal-field-row">
          <label for="timerStudyInput">Study session length (minutes)</label>
          <input type="number" id="timerStudyInput" min="1" />
        </div>
        <div class="modal-field-row">
          <label for="timerShortInput">Short break (minutes)</label>
          <input type="number" id="timerShortInput" min="1" />
        </div>
        <div class="modal-field-row">
          <label for="timerLongInput">Long break (minutes)</label>
          <input type="number" id="timerLongInput" min="1" />
        </div>
      </div>
      <div class="modal-footer">
        <div class="spacer"></div>
        <button class="btn btn-secondary" id="timerModalCancelBtn" type="button">Cancel</button>
        <button class="btn" id="timerModalSaveBtn" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- Stats Modal -->
  <div class="modal-backdrop" id="statsModalBackdrop">
    <div class="modal stats-modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div>
          <div class="modal-title">Study stats</div>
          <div class="modal-subtitle">
            Totals, subjects, and top files based on tracked sessions.
          </div>
        </div>
        <button class="modal-close-btn" id="statsModalCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body" id="statsModalBody"></div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="openInsightsBtn" type="button">Insights</button>
        <div class="spacer"></div>
        <button class="btn btn-secondary" id="statsModalCloseBtn2" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- Subject Settings Modal -->
  <div class="modal-backdrop" id="subjectSettingsBackdrop" hidden>
    <div class="modal subject-settings-modal" role="dialog" aria-modal="true" aria-labelledby="subjectSettingsTitle">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="subjectSettingsTitle">Subject settings</div>
          <div class="modal-subtitle">Rename the subject and adjust its color highlight.</div>
        </div>
        <button class="modal-close-btn" id="subjectSettingsCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="subject-settings-row">
          <label class="subject-settings-label" for="subjectSettingsNameInput">Subject name</label>
          <input type="text" id="subjectSettingsNameInput" />
        </div>
        <div class="subject-settings-row">
          <div class="subject-settings-label">Color</div>
          <div class="subject-settings-color">
            <div class="subject-settings-preview">
              <span class="subject-settings-dot" id="subjectSettingsDot"></span>
              <span class="subject-settings-preview-text" id="subjectSettingsColorLabel">Selected</span>
            </div>
            <div class="subject-swatch-grid" id="subjectSettingsSwatches"></div>
            <div class="subject-settings-custom">
              <label for="subjectSettingsCustomColor">Custom</label>
              <input type="color" id="subjectSettingsCustomColor" />
            </div>
          </div>
        </div>
        <div class="subject-settings-row">
          <label class="subject-settings-label" for="subjectSettingsStrength">Highlight strength</label>
          <input type="range" id="subjectSettingsStrength" min="0.05" max="0.6" step="0.05" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="subjectNotesBtn" type="button">Notes</button>
        <div class="spacer"></div>
        <button class="btn btn-secondary" id="subjectSettingsCancelBtn" type="button">Cancel</button>
        <button class="btn" id="subjectSettingsSaveBtn" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- Notice Modal -->
  <div class="modal-backdrop" id="noticeModalBackdrop" hidden>
    <div class="modal notice-modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div class="modal-title" id="noticeModalTitle">Notice</div>
      </div>
      <div class="modal-body" id="noticeModalMessage"></div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="noticeModalCancelBtn" type="button">Cancel</button>
        <button class="btn" id="noticeModalConfirmBtn" type="button">Confirm</button>
      </div>
    </div>
  </div>
	  <!-- Suggestions Modal -->
	  <div class="modal-backdrop" id="suggestionModalBackdrop" hidden>
	    <div class="modal suggestion-modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div>
          <div class="modal-title">Study suggestions</div>
          <div class="modal-subtitle">Low confidence, deadlines, and spaced review.</div>
        </div>
        <button class="modal-close-btn" id="suggestionModalCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body suggestion-modal-body" id="suggestionModalBody">
        <div class="suggestion-modal-section">
          <div class="suggestion-modal-head">
            <div class="modal-title-sm">Spaced review soon</div>
            <div class="modal-subtle" id="dueSoonHint"></div>
          </div>
          <div class="due-soon-list" id="dueSoonList"></div>
        </div>
        <div class="suggestion-modal-section">
          <div class="suggestion-modal-head">
            <div class="modal-title-sm">Smart suggestions</div>
            <div class="today-suggestions-cap" id="suggestionsCapNote"></div>
          </div>
          <div class="today-suggestions-list" id="suggestionsList"></div>
        </div>
        <div class="suggestion-modal-section">
          <div class="suggestion-modal-head">
            <div class="modal-title-sm">Due for review</div>
            <div class="modal-subtle" id="unifiedReviewHint"></div>
          </div>
          <div class="today-suggestions-list" id="unifiedReviewList"></div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="spacer"></div>
        <button class="btn btn-secondary" id="suggestionModalCloseBtn2" type="button">Close</button>
      </div>
    </div>
	  </div>

  <!-- Notes Modal -->
  <div class="calendar-modal notes-modal" id="notesModal" aria-hidden="true">
    <div class="calendar-modal-backdrop" id="notesModalBackdrop"></div>
    <div class="calendar-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="notesModalTitle">
      <div class="calendar-modal-head">
        <div>
          <div class="modal-label">Notes</div>
          <div class="modal-title" id="notesModalTitle">Notes</div>
          <div class="modal-subtitle" id="notesModalSubtitle">Markdown + KaTeX.</div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="closeNotesModalBtn" type="button">Close</button>
        </div>
      </div>
      <div class="calendar-form">
        <div class="notes-toolbar">
          <div class="notes-toolbar-left">
            <label class="sr-only" for="notesSearchInput">Search</label>
            <input class="notes-search" id="notesSearchInput" type="search" placeholder="Find in note‚Ä¶" />
            <button class="btn btn-secondary" id="notesSearchBtn" type="button">Find</button>
          </div>
          <div class="notes-toolbar-right">
            <button class="btn btn-secondary" id="notesToFlashcardsBtn" type="button">Create flashcards‚Ä¶</button>
            <label class="sr-only" for="notesInsertSelect">Insert link</label>
            <select id="notesInsertSelect"></select>
            <button class="btn btn-secondary" id="notesInsertBtn" type="button">Insert link</button>
          </div>
        </div>
        <div class="calendar-form-status" id="notesSaveHint" role="status" aria-live="polite"></div>
        <div class="notes-layout">
          <div class="notes-pane">
            <label class="sr-only" for="notesEditor">Markdown editor</label>
            <textarea class="notes-editor" id="notesEditor" rows="12" placeholder="# Notes&#10;&#10;- Use **bold** / *italic* / `code`&#10;- Math: $a^2 + b^2 = c^2$&#10;- Links: [Title](https://...)"></textarea>
          </div>
          <div class="notes-pane">
            <div class="notes-preview" id="notesPreview" aria-label="Preview"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Session Recap Modal -->
  <div class="modal-backdrop" id="sessionRecapBackdrop" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="sessionRecapTitle">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="sessionRecapTitle">Session recap</div>
          <div class="modal-subtitle" id="sessionRecapSubtitle">A quick note helps your future self.</div>
        </div>
        <button class="modal-close-btn" id="sessionRecapCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="modal-field-row">
          <label for="sessionRecapText">What did you do?</label>
          <textarea id="sessionRecapText" rows="3" placeholder="Key steps, what worked, what got stuck‚Ä¶"></textarea>
        </div>
        <div class="modal-field-row">
          <label for="sessionRecapRating">Was it effective?</label>
          <select id="sessionRecapRating">
            <option value="">Skip</option>
            <option value="1">1 ‚Äì Bad</option>
            <option value="2">2</option>
            <option value="3">3 ‚Äì OK</option>
            <option value="4">4</option>
            <option value="5">5 ‚Äì Great</option>
          </select>
        </div>
        <div class="modal-field-row modal-row-inline">
          <div>
            <label for="sessionRecapConfidence">Adjust confidence (optional)</label>
            <div class="range-row">
              <input type="range" id="sessionRecapConfidence" min="0" max="100" step="5" value="50" />
              <div class="range-value" id="sessionRecapConfidenceValue">50%</div>
            </div>
          </div>
          <div>
            <label for="sessionRecapTags">Tag (optional)</label>
            <select id="sessionRecapTags">
              <option value="">None</option>
              <option value="hard_topic">Hard topic</option>
              <option value="distraction">Distraction</option>
              <option value="good_flow">Good flow</option>
            </select>
          </div>
        </div>
        <div class="modal-field-row">
          <div class="modal-subtle" id="sessionRecapMeta"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="sessionRecapSkipBtn" type="button">Skip</button>
        <div class="spacer"></div>
        <button class="btn" id="sessionRecapSaveBtn" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- Insights Modal -->
  <div class="modal-backdrop" id="insightsBackdrop" hidden>
    <div class="modal insights-modal" role="dialog" aria-modal="true" aria-labelledby="insightsTitle">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="insightsTitle">Insights</div>
          <div class="modal-subtitle">Useful signals from your sessions and plans.</div>
        </div>
        <button class="modal-close-btn" id="insightsCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body" id="insightsBody"></div>
      <div class="modal-footer">
        <div class="spacer"></div>
        <button class="btn btn-secondary" id="insightsCloseBtn2" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- Flashcards generator preview (Notes ‚Üí Flashcards) -->
  <div class="calendar-modal" id="flashcardGenModal" aria-hidden="true">
    <div class="calendar-modal-backdrop" id="flashcardGenModalBackdrop"></div>
    <div class="calendar-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="flashcardGenTitle">
      <div class="calendar-modal-head">
        <div>
          <div class="modal-label">Flashcards</div>
          <div class="modal-title" id="flashcardGenTitle">Create flashcards</div>
          <div class="modal-subtitle">Preview and import into Karteikarten.</div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="closeFlashcardGenBtn" type="button">Close</button>
        </div>
      </div>
      <div class="calendar-form">
        <div class="form-row">
          <label>
            Target deck
            <select id="flashcardGenDeckSelect"></select>
          </label>
          <label>
            Or create new
            <input id="flashcardGenNewDeck" type="text" placeholder="New deck name (optional)" />
          </label>
        </div>
        <div class="calendar-form-status" id="flashcardGenStatus"></div>
        <div class="calendar-upcoming" id="flashcardGenList"></div>
        <div class="calendar-form-actions">
          <div class="calendar-form-buttons">
            <button class="btn btn-secondary" id="flashcardGenCancelBtn" type="button">Cancel</button>
            <button class="btn" id="flashcardGenImportBtn" type="button">Import cards</button>
          </div>
        </div>
      </div>
    </div>
  </div>

	  <button class="expand-btn" id="expandPageBtn" type="button" aria-label="Toggle expand">‚§¢</button>
	  <div id="studyAriaLive" class="sr-only" aria-live="polite" aria-atomic="true"></div>
	  <script src="./src/storage.js"></script>
	  <script src="./src/assignments.js"></script>
	  <script src="./src/notes.js"></script>
	  <script src="./src/time-budget.js"></script>
	  <script src="./src/session-journal.js"></script>
	  <script src="./src/insights.js"></script>
	  <script src="./src/review-engine.js"></script>
	  <script src="./src/notes-to-flashcards.js"></script>
	  <script src="./src/notifications.js"></script>
	  <script src="./src/data-tools.js"></script>
	  <script src="./src/pwa.js"></script>
	  <script src="./src/sync.js"></script>
	  <script src="./src/index/index.part1.js"></script>
	  <script src="./src/index/index.part2.js"></script>
	  <script src="./src/index/index.part3.js"></script>
	  <script src="./src/index/index.part4.js"></script>
	</body>
</html>
